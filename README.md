# PromptEmail Outlook Add-in

AI-Powered Email Analysis Outlook Add-in that enhances email productivity through large language model integration.

## Features

- **AI-Powered Email Analysis**: Intelligent email classification, tone detection, and response assistance
- **Multi-Provider AI Support**: OpenAI-compatible providers, Ollama (local), and custom on-site endpoints
- **Security-First Design**: Built-in classification detection (UNCLASSIFIED, SECRET, etc.) with compliance logging
- **Accessible Interface**: Full keyboard navigation, screen reader support, and high-contrast mode
- **Advanced Settings Management**: Persistent settings with Office 365 roaming and local backup
- **Real-time Email Processing**: Extract email content, analyze sentiment, and generate contextual responses
- **Cloud Telemetry Pipeline**: Secure telemetry via AWS API Gateway eliminating CORS and credential issues
- **Windows Logging Integration**: PowerShell-based event logging to Windows Application Log

## Quick Start

### Prerequisites

- Node.js 16+ and npm
- Outlook Desktop (Microsoft 365 subscription)
- PowerShell 5.1+ or PowerShell Core 7+ (Windows)
- AWS CLI configured (for deployment to S3)

### Installation

1. Clone the repository and install dependencies:
```bash
npm install
```

2. Build the project:
```bash
npm run build
```

3. Configure deployment environment in `tools\deployment-environments.json`

4. Deploy using the build and deploy script:
```bash
.\tools\deploy_web_assets.ps1 -Environment Prd
```

5. Sideload the manifest (`manifest.xml`) in Outlook

### Development

- **Start development watcher**: `npm run dev`
- **Build for production**: `npm run build`
- **Deploy to environment**: `.\tools\deploy_web_assets.ps1 -Environment Dev`
- **Validate manifest**: `npm run validate-manifest`

## Architecture

### Frontend Stack
- **Framework**: Vanilla JavaScript with ES6 modules and classes
- **Build System**: Webpack 5 with HtmlWebpackPlugin and CopyWebpackPlugin
- **Styling**: CSS3 with CSS custom properties and Grid/Flexbox layouts
- **Bundling**: Separate bundles for taskpane and commands functionality

### Core Services Architecture
- **EmailAnalyzer**: Extracts and processes email content from Office.js API
- **AIService**: Multi-provider AI integration (OpenAI-compatible, Ollama, Custom on-site providers)
- **ClassificationDetector**: Security classification pattern matching and validation
- **SettingsManager**: Dual-storage settings (Office.js roaming + localStorage backup)
- **Logger**: Cloud telemetry via AWS API Gateway and Windows Application Log integration
- **UIController**: State management, loading states, and user feedback
- **AccessibilityManager**: ARIA live regions, keyboard navigation, screen reader support

### Deployment Architecture
- **Hosting**: AWS S3 static website hosting
- **Telemetry Pipeline**: AWS API Gateway → Lambda → EC2 Splunk Enterprise for secure data collection
- **Build Pipeline**: PowerShell-based build and deployment automation
- **Environment Management**: Multi-environment support (Dev/Prd) with URL rewriting
- **Asset Management**: Automated file discovery and URL updating for deployments

### Office Integration
- **Manifest**: Office Add-in manifest with ribbon integration
- **API Integration**: Office.js API for email reading, writing, and user context
- **Extension Points**: Message read and compose command surfaces
- **Authentication**: Office 365 user profile integration

## Security & Compliance

- **Email Classification Detection**: Automatic detection of security markings (UNCLASSIFIED, CONFIDENTIAL, SECRET, TOP SECRET, COSMIC TOP SECRET)
- **User Override Protection**: Warning system with mandatory user acknowledgment for classified content
- **Audit Logging**: Comprehensive event logging to Windows Application Log with sanitized data
- **Data Privacy**: Sensitive content filtering in logs and telemetry
- **API Key Security**: Secure storage using Office.js roaming settings with localStorage fallback
- **Content Sanitization**: Automatic removal of sensitive data from all logging and telemetry

## Directory Structure

```
├── public/                     # Built assets (generated by webpack)
├── src/                       # Source code
│   ├── services/              # Core business logic services
│   │   ├── AIService.js       # Multi-provider AI integration
│   │   ├── EmailAnalyzer.js   # Email content extraction
│   │   ├── ClassificationDetector.js # Security classification detection
│   │   ├── SettingsManager.js # Persistent settings management
│   │   └── Logger.js          # Windows event logging
│   ├── ui/                    # UI components and accessibility
│   │   ├── UIController.js    # State management and user feedback
│   │   └── AccessibilityManager.js # ARIA and keyboard navigation
│   ├── taskpane/              # Main application interface
│   │   ├── taskpane.html      # Application HTML template
│   │   └── taskpane.js        # Main application controller
│   ├── commands/              # Office ribbon commands
│   │   ├── commands.html      # Command page template
│   │   └── commands.js        # Ribbon command handlers
│   ├── assets/               # Static assets (CSS, icons)
│   ├── config/                # Configuration files
│   │   ├── ai-providers.json # AI provider configurations (includes model lists)
│   │   └── telemetry.json    # Telemetry and logging configuration
│   └── manifest.xml          # Office Add-in manifest
├── tools/                    # Build and deployment scripts
│   ├── deploy_web_assets.ps1  # Main build and deploy automation
│   └── deployment-environments.json # Environment configurations
├── webpack.config.js        # Build configuration
└── package.json            # Project dependencies and scripts
```

## AI Provider Support

The add-in supports multiple AI providers with automatic model discovery:

- **OpenAI-Compatible**: Standard OpenAI API endpoints with API key authentication
- **Ollama**: Local LLM hosting with automatic model detection via `/api/tags`
- **Custom On-Site Providers**: Support for OnSiteProvider-1, OnSiteProvider-2, and other OpenAI-compatible endpoints available in your work environment

### Default Configurations
- Provider endpoints and models are defined in `src/default-providers.json` and `src/default-models.json`
- Runtime model discovery for Ollama installations
- Fallback configurations for offline scenarios

## Deployment

See `DEPLOYMENT_GUIDE.md` for detailed deployment instructions.

## Contributing

1. Fork the repository and create a feature branch
2. Follow the development setup in `DEVELOPER_GUIDE.md`
3. Make your changes with appropriate tests
4. Ensure accessibility compliance (WCAG 2.1 AA)
5. Update documentation as needed
6. Submit a pull request with clear description

## License

MIT License - see LICENSE file for details.
